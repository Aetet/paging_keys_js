function HotKey(a){this.target=a||document;this._keyfunc={};this.init()}HotKey.kc2char=function(b){var c=function(f,e){return f<=b&&b<=e};var a="space pageup pagedown end home left up right down".split(" ");var d={8:"back",9:"tab",13:"enter",16:"shift",17:"ctrl",46:"delete"};return(c(65,90)?String.fromCharCode(b+32):c(48,57)?String.fromCharCode(b):c(96,105)?String.fromCharCode(b-48):c(32,40)?a[b-32]:d.hasOwnProperty(b)?d[b]:null)};HotKey.prototype.ignore=/input|textarea/i;HotKey.prototype.init=function(){var a=this;var b=function(c){a.onkeydown(c)};if(this.target.addEventListener){this.target.addEventListener("keydown",b,true)}else{this.target.attachEvent("onkeydown",b)}};HotKey.prototype.onkeydown=function(c){var a=(c.target||c.srcElement).tagName;if(this.ignore.test(a)){return}var b=HotKey.kc2char(c.keyCode);if(c.shiftKey&&b.length==1){b=b.toUpperCase()}if(c.altKey){b="A"+b}if(c.ctrlKey){b="C"+b}if(this._keyfunc.hasOwnProperty(b)){this._keyfunc[b].call(this,c)}};HotKey.prototype.sendKey=function(a){this._keyfunc[a]&&this._keyfunc[a]()};HotKey.prototype.add=function(b,c){if(b.constructor==Array){for(var a=0;a<b.length;a++){this._keyfunc[b[a]]=c}}else{this._keyfunc[b]=c}};HotKey.prototype.remove=function(b){if(b.constructor==Array){for(var a=0;a<b.length;a++){this._keyfunc[b[a]]=function(){}}}else{this._keyfunc[b]=function(){}}};var pagingKeys=function(){var s={nodeSelector:".hentry h2 a.entry-title",prevPageSelector:".prev_page",nextPageSelector:".next_page",pagingNavId:"paging-nav",keyNext:"j",keyPrev:"k",keyNextPage:"h",keyPrevPage:"l",keyRefresh:"r",additionalBodyClass:"paging-keys",bottomAnchor:"bottom"};var l=[];var p=false;var c=false;var h=false;function n(){if(Prototype.Browser.MobileSafari){return}$(document).observe("dom:loaded",function(){var u=this.body;u.className=u.className?u.className+(" "+s.additionalBodyClass):s.additionalBodyClass;q();j();r()});Event.observe(window,"scroll",function(){j()})}function q(){p=false;l.clear();if($$(s.prevPageSelector)[0]){if($$(s.prevPageSelector)[0].href){l.push({id:"prev",y:0})}}else{l.push({id:null,y:0})}var u=$$(s.nodeSelector);for(var v=0;v<u.length;v++){var x=u[v];if(x.id.match(/^post/i)){o(x)}}l.sort(function(z,y){return z.y-y.y});var w=l.length-1;if($$(s.nextPageSelector)[0]){if($$(s.nextPageSelector)[0].href){l.push({id:"next",y:document.body.scrollHeight})}}p=true}function o(v){var u=Position.cumulativeOffset(v);l.push({id:v.id,y:u[1]-20})}function j(){if($(s.pagingNavId)){$(s.pagingNavId).setStyle({position:"absolute",right:"10px",top:(f()+10)+"px"})}}function r(){try{c=new HotKey()}catch(u){alert("Oops, paging_keys requires HotKeys.js (http://la.ma.la/blog/diary_200511041713.htm)");alert(u)}if(c){c.add(s.keyNext,function(){m(1)});c.add(s.keyPrev,function(){m(-1)});c.add(s.keyNextPage,function(){a(1)});c.add(s.keyPrevPage,function(){a(-1)});c.add(s.keyRefresh,function(){location.reload()})}}function b(){return{w:document.viewport.getDimensions()["width"],h:document.viewport.getDimensions()["height"],x:document.viewport.getScrollOffsets()["left"],y:document.viewport.getScrollOffsets()["top"]}}function f(){return document.viewport.getScrollOffsets()["top"]}function i(v){if(Prototype.Browser.IE){var u=document.createElement("a");u.style.display="none";u.href=v;document.body.appendChild(u);u.click()}else{location.href=v}}function k(){if(c){h=true;c.remove(s.keyNext);c.remove(s.keyPrev);c.remove(s.keyNextPage);c.remove(s.keyPrevPage)}}function m(B,w){if(!p){return false}if(w==null){w=g(B)}var A=f();if(w){if(w.id=="prev"||w.id=="next"){if(w.id=="next"){e()}else{d()}return false}var v=$("post-"+w.id)||$(w.id);var u=0,z=0;if(v){v.focus();z=w.y}else{z=w.y}window.scrollTo(u,z);if((B>0)&&(A==f())){a(1)}}return true}function g(x,w){if(w==null){w=f()}var v=l.length-1;for(var u=0;u<l.length;u++){if(w<l[u].y){v=u-1;break}}if((x<0&&l[v]&&l[v].y==w)||0<x){v+=x}else{if(b().h+f()==document.body.scrollHeight&&0<x){v++}}v=Math.max(v,0);return l[v]}function t(){var v=document.body.scrollTop;var u=document.body.scrollLeft;var w=document.body.scrollHeight;var x=0;if(Prototype.Browser.WebKit){x=window.innerHeight}else{x=document.body.clientHeight}return{top:v,left:u,height:w,clientHeight:x,is_at_top:v==0&&u==0,is_at_last:v+x==w&&u==0}}function a(v){var u=t();if(v<0){if(u.is_at_top){d()}else{window.scroll(0,0)}}else{if(u.is_at_last){e()}else{window.scroll(0,u.height)}}}function e(){if($$(s.nextPageSelector)[0]){if($$(s.nextPageSelector)[0].href!=null){i($$(s.nextPageSelector)[0].href);k();return true}}else{return false}}function d(){if($$(s.prevPageSelector)[0].href!=null){i($$(s.prevPageSelector)[0].href+"#"+s.bottomAnchor);k();return true}else{return false}}return{init:n,moveToItem:m,movePage:a,currentItem:g,config:s,item_map:l}}();pagingKeys.init();